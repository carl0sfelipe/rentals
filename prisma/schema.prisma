generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id         String             @id @default(uuid()) @db.Uuid
  name       String
  slug       String             @unique
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @updatedAt
  bookings   Booking[]
  members    OrganizationUser[]
  properties Property[]

  @@map("organizations")
}

model OrganizationUser {
  id             String           @id @default(uuid()) @db.Uuid
  role           OrganizationRole @default(MEMBER)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  userId         String           @db.Uuid
  organizationId String           @db.Uuid
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId])
  @@index([organizationId])
  @@index([userId])
  @@map("organization_users")
}

model User {
  id                   String             @id @default(uuid()) @db.Uuid
  email                String             @unique
  name                 String
  password             String
  activeOrganizationId String?            @db.Uuid
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  organizations        OrganizationUser[]
  properties           Property[]

  @@index([activeOrganizationId])
  @@map("users")
}

model Property {
  id             String          @id @default(uuid()) @db.Uuid
  title          String
  description    String
  address        String
  pricePerNight  Float
  bedrooms       Int
  bathrooms      Int
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  organizationId String?         @db.Uuid
  userId         String          @db.Uuid
  imageUrl       String?
  publicUrl      String?
  showCountdown  Boolean         @default(true)
  showHighDemand Boolean         @default(true)
  showViewCount  Boolean         @default(true)
  bookings       Booking[]
  events         CalendarEvent[]
  organization   Organization?   @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User            @relation(fields: [userId], references: [id])

  @@index([organizationId])
  @@index([organizationId, createdAt])
  @@map("properties")
}

model CalendarEvent {
  id         String    @id @default(uuid())
  propertyId String    @db.Uuid
  type       EventType
  startDate  DateTime
  endDate    DateTime
  title      String?
  status     String?
  color      String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  property   Property  @relation(fields: [propertyId], references: [id])

  @@index([propertyId, startDate, endDate])
  @@map("calendar_events")
}

model Booking {
  id             String        @id @default(cuid())
  startDate      DateTime
  endDate        DateTime
  type           BookingType   @default(BLOCKED)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organizationId String?       @db.Uuid
  propertyId     String        @db.Uuid
  guestCount     Int?          @default(1)
  guestsDetail   Json?
  observations   String?
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  property       Property      @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([organizationId, createdAt])
  @@index([propertyId])
  @@map("bookings")
}

enum EventType {
  RESERVATION
  BLOCKED
  MAINTENANCE
}

enum OrganizationRole {
  ADMIN
  MANAGER
  MEMBER
  CLEANER
  PROPRIETARIO
}

enum BookingType {
  BLOCKED
  RESERVATION
  MAINTENANCE
}
